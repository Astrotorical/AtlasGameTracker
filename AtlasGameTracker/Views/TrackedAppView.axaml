<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:models="using:AtlasGameTrackerLibrary.models"
             xmlns:views="using:AtlasGameTrackerUI"
             xmlns:vm="using:AtlasGameTrackerUI.ViewModels"
             x:DataType="vm:TrackedAppViewModel"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="AtlasGameTrackerUI.TrackedAppView">
<UserControl.DataContext>
	<vm:TrackedAppViewModel/>
</UserControl.DataContext>
    
<SplitView IsPaneOpen="{Binding IsPanelOpen}"
           OpenPaneLength="300"
           CompactPaneLength="0"
           DisplayMode="CompactInline">
	<SplitView.Pane>
        <!-- Use a Grid so the ListBox gets constrained and can show scrollbars -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Margin="10" VerticalAlignment="Center" Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Command="{Binding AddRegisteredAppCommand}"
                        Width="32" Height="32"
                        ToolTip.Tip="Add new registered application">
                    <TextBlock Text="+" HorizontalAlignment="Center" FontWeight="Bold" VerticalAlignment="Center"/>
                </Button>
                <TextBlock Grid.Column="1" Margin="0,0,20,0" Text="Registered Applications" FontWeight="SemiBold" VerticalAlignment="Center" />
            </Grid>

            <!-- Constrained row: ListBox will show a scrollbar when items exceed the visible height -->
            <ListBox Grid.Row="1" 
                     ItemsSource="{Binding RegisteredApps}"
                     SelectedItem="{Binding SelectedApp}"
                     SelectionChanged="OnSelectedAppChanged"
                     VerticalAlignment="Stretch"
                     HorizontalAlignment="Stretch">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="models:RegisteredApp">
                        <TextBlock Text="{Binding DisplayName}" FontSize="16" Margin="5"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </SplitView.Pane>
    <SplitView.Content>
        <StackPanel>
            <Button Command="{Binding TogglePanelCommand}" ToolTip.Tip="Hide panel">
                <Image HorizontalAlignment="Center" VerticalAlignment="Center" Source="avares://AtlasGameTrackerUI/Assets/3lines.png" Width="24" Height="24"/>
            </Button>
            <StackPanel Margin="20" IsVisible="{Binding HasSelectedApp}">
				<TextBlock Text="{Binding SelectedApp.DisplayName}" FontSize="24" FontWeight="Bold" Margin="0,0,0,10"/>
                <TextBlock Text="Application Process Name:" FontSize="18" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding SelectedApp.ProcessName}" FontSize="16" Margin="0,0,0,10"/>
                <TextBlock Text="Total Playtime:" FontSize="18" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding SelectedApp.TotalPlaytime, StringFormat='{} {0} hrs'}" FontSize="16" Margin="0,0,0,10"/>
                <TextBlock Text="Toggle Tracking:" FontSize="18" FontWeight="SemiBold"/>
                <ToggleSwitch IsChecked="{Binding IsTrackingEnabled}" Command="{Binding ToggleTrackingCommand}" FontSize="16"/>
                <TextBlock Text="Sessions:" FontSize="18" FontWeight="SemiBold"/>
                <ListBox ItemsSource="{Binding SelectedApp.Sessions}" MaxHeight="250" MaxWidth="1000" HorizontalAlignment="Left">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:Session">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock FontWeight="Bold" Text="{Binding SessionDuration, StringFormat='{} {0} hrs'}"/>
                                <TextBlock Text="{Binding StartTime}"/>
                                <TextBlock Text=" - "/>
                                <TextBlock Text="{Binding EndTime}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
            <TextBlock Text="No application selected." FontSize="18" FontStyle="Italic" Margin="20" IsVisible="{Binding !HasSelectedApp}"/>
        </StackPanel>
    </SplitView.Content>
</SplitView>

</UserControl>
